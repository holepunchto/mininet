const createTestnet = require('hyperdht/testnet')
const process = require('process')
const { randomBytes } = require('hypercore-crypto')
const { SimHash } = require('simhash-vocabulary')

const ip = process.argv[2]
const skipPut = process.argv[3] === 'skip'

const vocabulary = [
  'apple',
  'table',
  'window',
  'pencil',
  'chair',
  'water',
  'book',
  'garden',
  'cloud',
  'bridge',
  'mountain',
  'river',
  'ocean',
  'forest',
  'stone',
  'mirror',
  'candle',
  'basket',
  'flower',
  'blanket',
  'pillow',
  'lamp',
  'carpet',
  'clock',
  'drawer',
  'kitchen',
  'ceiling',
  'hallway',
  'doorway',
  'staircase',
  'bedroom',
  'bathroom',
  'garage',
  'driveway',
  'sidewalk',
  'pavement',
  'street',
  'highway',
  'tunnel',
  'building',
  'tower',
  'castle',
  'temple',
  'statue',
  'fountain',
  'plaza',
  'market',
  'bakery',
  'grocery',
  'pharmacy',
  'library',
  'museum',
  'theater',
  'stadium',
  'airport',
  'station',
  'platform',
  'terminal',
  'vessel',
  'anchor',
  'harbor',
  'lighthouse',
  'island',
  'peninsula',
  'continent',
  'planet',
  'satellite',
  'telescope',
  'microscope',
  'thermometer',
  'compass',
  'calculator',
  'computer',
  'keyboard',
  'monitor',
  'printer',
  'scanner',
  'camera',
  'photograph',
  'painting',
  'sculpture',
  'drawing',
  'sketch',
  'canvas',
  'palette',
  'brush',
  'crayon',
  'marker',
  'eraser',
  'ruler',
  'notebook',
  'folder',
  'envelope',
  'package',
  'container',
  'bottle',
  'jar',
  'cup',
  'plate',
  'bowl',
  'spoon',
  'fork',
  'knife',
  'napkin',
  'tablecloth',
  'counter',
  'cabinet',
  'shelf',
  'closet',
  'wardrobe',
  'dresser',
  'nightstand',
  'sofa',
  'armchair',
  'cushion',
  'curtain',
  'blinds',
  'shutter',
  'rooftop',
  'chimney',
  'gutter',
  'fence',
  'gate',
  'pathway',
  'meadow',
  'valley',
  'hillside',
  'plateau',
  'canyon',
  'desert',
  'tundra',
  'glacier',
  'waterfall',
  'stream',
  'pond',
  'swamp',
  'marsh',
  'prairie',
  'woodland',
  'grove',
  'orchard',
  'vineyard',
  'farmland',
  'pasture',
  'barnyard',
  'stable',
  'henhouse',
  'silo',
  'tractor',
  'wagon',
  'barrel',
  'bucket',
  'rake',
  'hatchet',
  'hammer',
  'wrench',
  'screwdriver',
  'pliers',
  'toolbox',
  'workbench',
  'sawdust',
  'timber',
  'plank',
  'beam',
  'brick',
  'sand',
  'clay',
  'soil',
  'dust',
  'pebble',
  'boulder',
  'granite',
  'marble',
  'limestone',
  'quartz',
  'crystal',
  'diamond',
  'emerald',
  'sapphire',
  'ruby',
  'topaz',
  'amber',
  'pearl',
  'coral',
  'seashell',
  'starfish',
  'dolphin',
  'whale',
  'shark',
  'octopus',
  'jellyfish',
  'seahorse',
  'turtle',
  'penguin',
  'pelican',
  'seagull',
  'sparrow',
  'robin',
  'cardinal',
  'bluebird',
  'finch',
  'hummingbird',
  'butterfly',
  'dragonfly',
  'beetle',
  'grasshopper',
  'cricket',
  'firefly',
  'caterpillar',
  'ladybug',
  'spider',
  'squirrel',
  'rabbit',
  'chipmunk',
  'raccoon',
  'beaver',
  'otter',
  'hedgehog',
  'porcupine',
  'badger',
  'weasel',
  'mole',
  'gopher',
  'hamster',
  'gerbil',
  'guinea',
  'ferret',
  'parrot',
  'canary',
  'parakeet',
  'macaw',
  'cockatoo',
  'pigeon',
  'dove',
  'falcon',
  'eagle',
  'hawk',
  'owl',
  'vulture',
  'ostrich',
  'flamingo',
  'peacock',
  'pheasant',
  'quail',
  'turkey',
  'chicken',
  'rooster',
  'duckling',
  'gosling',
  'cygnet',
  'foal',
  'calf',
  'lamb',
  'piglet',
  'kitten',
  'puppy'
]

async function main() {
  console.log('connecting to bootstrap at', ip)

  const bootstrap = [{ host: ip, port: 49737 }]

  const { nodes } = await createTestnet(100, bootstrap, { simhash: new SimHash(vocabulary) })

  await new Promise((res) => setTimeout(res, 1000))

  console.log('client ready')

  if (!skipPut) {
    const pointer = randomBytes(32)
    await nodes[0].searchableRecordPut(['planet', 'satellite'], pointer)
  }

  await new Promise((res) => setTimeout(res, 1000))

  const res = await nodes[1].search(['planet', 'satellite'])
  console.log(res)
}

main()
